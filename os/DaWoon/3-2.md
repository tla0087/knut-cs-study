# 프로세스 제어 블록과 문맥 교환

## 프로세스 제어 블록
---
```
프로세스 제어 블록(PCB)은 프로세스를 실행하는 데 필요한 중요한 정보를 보관하는
자료 구조로 TCB(Task Control Block)라고도 불린다.

모든 프로세스는 고유의 프로세스 제어 블록을 가지며, 프로세스 생성 시 만들어져서
프로세스가 실행을 완료하면 폐기된다.

PCB에 저장되는 정보가 무엇이고, 각 정보는 어떤 역할을 할까?
```

### 포인터
- PCB의 첫 번째 블록에 저장된다.
- 프로세스 제어 블록을 연결하여 준비상태나 대기 상태의 큐를 구현 할 때 포인터를 사용한다.

### 프로세스 상태
- 프로세스가 현재 어떤 상태(생성, 준비, 실행, 대기, 보류)에 있는지를 나타낸다.
- PCB의 두 번째 블록에 저장된다.

### 프로세스 구분자
- 여러 프로세스를 구분하기 위한 구분자를 저장한다.

### 프로그램 카운터
- 다음에 실행될 명령어의 주소를 가리키는 프로그램 카운터(PC)의 값을 저장한다.

### 프로세스 우선순위
- 프로세스는 중요도가 각각 다르다. ex) 커널 프로세스 > 사용자 프로세스
- 다양한 우선순위의 프로세스가 대기 상태로 들어오기 때문에 대기 상태의 큐도 우선순위별로 따로 운영된다. => 우선순위에 따라 PCB들이 여러 줄로 서 있다.
- CPU 스케줄러가 준비 상태에 있는 프로세스 중 실행 상태로 옮겨야 할 프로세스를 선택할 때는 프로세스 **우선순위를 기준**으로 삼는다.

### 각종 레지스터 정보
- PCB에는 프로세스가 실행되는 중에 사용하던 레지스터, 누산기, 색인 레지스터, 스택 포인터와 같은 레지스터의 값이 저장된다.
- 이전에 실행할 때 사용한 레지스터의 값을 보관해야 다음에 실행 할 수 있기 때문이다.

### 메모리 관리 정보
- 프로세스가 메모리의 어디에 있는지 나타내는 메모리 위치 정보, 메모리 보호를 위해 사용하는 경계 레지스터 값과 한계 레지스터 값 등이 저장된다.
- 세그먼테이션 테이블, 페이지 테이블 등의 정보도 보관한다.

### 할당된 자원 정보
- 프로세스를 실행하기 위해 사용하는 입출력 자원이나 오픈 파일 등에 대한 정보를 저장한다.

### 계정 정보
- 계정 번호, CPU 할당 시간, CPU 사용 시간 등의 정보를 저장한다.

### 부모 프로세스 구분자(PPID)와 자식 프로세스 구분자(CPID)
- 부모 프로세스를 가리키는 PPID와 자식 프로세스를 가리키는 CPID 정보도 저장된다.

<br>

## 포인터의 역할
- 컴퓨터엔 다양한 입출력 장치가 있다. => 그만큼 대기 상태로 모이는 프로세스도 다양하고, 많다.
- 다양하고 많은 프로세스를 한 곳에 다 모아두면 불편해진다. = 검색이 어렵기 때문
  + ex) 
  + HDD로부터 인터럽트가 들어왔을 때 대기 상태의 프로세스가 한 곳에 모여 있으면 해당 프로세스를 찾기 위해 대기 상태에 있는 모든 프로세스를 검색해야함
- 검색을 좀 더 쉽게 하기 위해 대기 상태에는 **같은 입출력끼리** 프로세스를 모아둔다.

- 대기 상태에서 같은 입출력을 기다리는 PCB은 동일한 입출력 큐에 모여 있는데 이를 대기 큐라고 한다.
  + ex)
  + 하드디스크의 입출려글 기다리는 PCB은 하드디스크 큐에 삽입된다.
  + 이후 하드디스크로부터 완료 인터럽트가 도착하면 하드디스크 큐에 있는 프로세스 제어 블록을 검색한다.
  + 해당 프로세스 제어 블록의 상태를 준비 상태로 바꾸고 하드디스크 큐에서 제거한 후 준비 큐로 이동한다.
- 대기 큐뿐만 아니라 준비 큐도 여러 개로 존재한다.


<br><br>

## 문맥 교환
---
### 문맥 교환의 의미
- 문맥 교환은 CPU를 차지하던 프로세스가 나가고 새로운 프로세스를 받아들이는 작업을
말한다. 이때 두 PCB의 내용이 변경된다.
   + 실행 상태 -> 준비 상태로 나가는 과정
     * 지금까지의 작업 내용을 저장
   + 준비 상태 -> 실행 상태로 들어오는 과정
     * 실행 상태로 들어오는 PCB의 내용으로 CPU가 세팅됨
     * 이전 작업 상태가 되어야 다음 작업을 할 수 있기 때문
- 두 프로세스의 PCB을 교환하는 작업이 문맥 교환이다.

<br><br>

### 문맥 교환의 절차
![ContextSwitching](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fqu6FQ%2FbtqIdrCvyNG%2Fv2UFfWQDq6VBFop4nKort0%2Fimg.png)

- 실행 상태에 있는 프로세스 P1이 자신에게 주어진 시간을 다 사용하여 타임아웃이 되면 P1의 PCB에 현재까지의 작업 결과가 저장되고 P1은 준비 상태로 쫓겨난다.
- 준비 상태에 있던 프로세스 P2가 실행 상태로 가면 CPU의 레지스터가 P2의 PCB 값으로 채워져 다음 작업을 하게 된다.

<br>

- 문맥 교환이 일어나는 경우
  1. 한 프로세스가 주어진 CPU 할당 시간을 다 사용했을 때
  2. 인터럽트가 발생했을 때 