# 1-3. 운영체제의 구조

## 커널과 인터페이스

- 커널(Kernel)
  - 프로세스 관리, 메모리 관리, 저장장치 관리와 같은 운영체제의 핵심적인 기능을 모아놓은 것
  - 운영체제의 성능은 커널이 좌우한다.
- 인터페이스
  - 커널에 사용자의 명령을 전달하고 실행 결과를 사용자에게 알려주는 역할을 함.
  - CMD, PowerShell 같은 터미널

![image](https://user-images.githubusercontent.com/64275588/154912556-189d5095-bf21-4356-be93-8e6d00e07906.png)

<br>

## 시스템 호출과 디바이스 드라이버

- **시스템 호출(System Call)**
  - 사용자나 응용 프로그램이 자원에 직접 접근하는 것을 차단.
  - 왜? 컴퓨터 자원을 보호하기 위해.
- 직접 접근
  - 사용자가 직접 컴퓨터 자원에 접근하여 작업하는 방식.
  - 사용자가 모든 것을 처리.
- 시스템 호출을 통한 접근
  - 누군가에게 요청하여 작업의 결과만 받는 방식.
- 직접 접근 vs 시스템 호출을 통한 접근 비교해보기
  - 어떤 응용 프로그램은 숫자 14를, 어떤 응용 프로그램은 숫자 21을 하드디스크에 저장하려고 한다고 가정.
  - 직접 접근 : 응용 프로그램들은 지 맘대로 저장하려고 할 것이기 때문에, 한 사람이 다른 사람의 데이터를 지울 수도 있음.
  - 시스템 호출을 통한 접근
    - `시스템 콜 write()`를 사용하여 데이터를 저장해달라고 요청
    - 이 때 응용 프로그램은 데이터가 하드디스크의 어느 위치에 어떤 방식으로 저장되는지 알 수 없음
    - 저장된 데이터를 읽어오고 싶으면 `read() 시스템 콜`
    - 즉, 데이터를 가져오거나 저장하는 것을 커널이 전적으로 책임지므로, 컴퓨터 자원 관리가 수월해짐.
- 시스템 콜 정리하기!
  - 시스템 콜은 커널이 제공하는 시스템 자원의 사용과 연관된 [함수](https://man7.org/linux/man-pages/man2/syscalls.2.html)
  - 응용 프로그램이 하드웨어 자원에 접근하거나 운영체제가 제공하는 서비스를 이용하려 할 때는 시스템 콜을 사용해야 함.
  - OS는 커널이 제공하는 서비스를 시스템 호출로만 실행 가능하도록 제한하고, 다른 방법으로 커널에 들어오지 못하게 막음으로써 컴퓨터 자원을 보호.
  - 시스템 호출은 커널이 제공하는 서비스를 이용하기 위한 인터페이스, 사용자가 자발적으로 커널 영역에 진입할 수 있는 유일한 수단.
- **드라이버**
  - 응용 프로그램과 커널의 인터페이스 : 시스템 호출
  - 커널과 하드웨어의 인터페이스 : 드라이버
  - 드라이버? 하드웨어의 구동을 위한 소프트웨어
  - 커널은 입출력의 기본적인 부분만 제작하고, 하드웨어의 특성을 반영한 드라이버는 하드웨어 제작자가 제공.
  - 즉, 하드웨어는 커널과 직접 연결되기도 하고 하드웨어 제작자가 제공하는 드라이버를 통해 연결되기도 한다.

<br>

## 커널이 하는 일

| 핵심 기능             | 설명                                                         |
| --------------------- | ------------------------------------------------------------ |
| 프로세스 관리         | 프로세스에 CPU를 배분하고 작업에 필요한 제반 환경을 제공     |
| 메모리 관리           | 프로세스에 작업 공간을 배치하고 실제 메모리보다 큰 가상공간을 제공 |
| 파일 시스템 관리      | 데이터를 저장하고 접근할 수 있는 인터페이스를 제공           |
| 입출력 관리           | 필요한 입력과 출력 서비스를 제공                             |
| 프로세스 간 통신 관리 | 공동 작업을 위한 각 프로세스 간 통신 환경을 지원             |

<br>

## 커널의 종류

- 단일형 구조 커널
  - 커널의 핵심 기능을 구현하는 모듈들이 구분 없이 하나로 구성.
  - 비유하자면, int main()에 모든 기능을 몰아놓은 형태.
  - 장점
    - 모듈이 거의 분리되지 않고 몰려있어, 모듈 간의 통신 비용이 적음. (오버헤드 적음)
  - 단점
    - 모듈이 하나로 묶여 있어 버그를 처리하기 힘듦.
    - 각 기능들의 상호 의존성이 높아 작은 결함 하나가 시스템 전체의 오류로 확산 가능성.
    - 다양한 환경의 시스템에 이식, 적용하기 어려움.
    - 현대 운영체제는 매우 크고 복잡하므로 이러한 구조가 부적합.
- 계층형 구조 커널
  - 비슷한 기능을 가진 모듈을 묶어서 하나의 계층으로 만듦.
  - 계층 간의 통신을 통해 운영체제를 구현.
  - 오늘날 운영체제는 대부분 이 구조.
  - 장점
    - 계층별로 모듈화되어 있어, 단일형 구조보다 버그나 오류를 쉽게 처리할 수 있음.
    - 왜? 오류 발생한 계층만 수정하면 되니까
- 마이크로 구조 커널
  - 계층형 구조 커널 너무 크고 복잡해.. 소스도 방대해.. 오류 잡기도 어려워.. 반대로 만들어볼까?
  - 프로세스 관리, 메모리 관리, 프로세스 간 통신 관리 등 가장 기본적인 기능만 제공.
  - 많은 컴퓨터에 이식하기 쉽고 커널이 가벼워 CPU 용량이 작은 시스템에도 적용 가능.
  - 애플의 OS X, iOS 등.

## 가상머신

- JVM (Java Virtual Machine)
  - 자바로 프로그래밍을 하면 대부분의 운영체제에서 작동한다.
  - 왜? 운영체제 위에 가상머신을 만들고, 그 위에서 응용 프로그램이 작동하므로.
  - 따라서, 개발자는 하나의 코드만 만들면 여러 운영체제에서 똑같이 실행할 수 있음.
- 운영체제
  - 나 윈도우 환경에서 유닉스도 사용하고 싶어!
  - 운영체제를 두 개 설치하고 부팅시마다 선택해서 쓸 수도 있지만...
  - 유닉스 쓸 일도 별로 없는데 굳이 왜 깜?
  - 윈도우 운영체제에 유닉스 가상머신 설치해서 쓸 수도 있음.
  - 장점 : 웬만한 환경에서 다 쓸 수 있다는 호환성
  - 단점 : 느려터짐